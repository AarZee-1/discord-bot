import discord
from discord.ext import commands
import gspread
from google.oauth2.service_account import Credentials

# Bot Token (Replace with your actual bot token)
BOT_TOKEN = "MTM1MTIyMjQwODE5NTA4NDQxNA.GePxrr.s3uKJktXTX3c5LiRujSA1CLIevqFBMpS-hpLDU"

# Google Sheets Setup
SERVICE_ACCOUNT_FILE = "your_credentials.json"  # JSON key file
SPREADSHEET_ID = "your_spreadsheet_id_here"  # Google Sheets ID

# Authenticate with Google Sheets
creds = Credentials.from_service_account_file(SERVICE_ACCOUNT_FILE, scopes=["https://www.googleapis.com/auth/spreadsheets"])
client = gspread.authorize(creds)
sheet = client.open_by_key(SPREADSHEET_ID).sheet1  # Access first sheet

# Discord Bot Setup
intents = discord.Intents.default()
intents.members = True  # Ensure the bot can read member details
bot = commands.Bot(command_prefix="!", intents=intents)

# Function to add a verified user to Google Sheets
def add_verified_user(discord_id, username, email):
    sheet.append_row([discord_id, username, email])

# Verification Command
@bot.command()
async def verify(ctx, email: str):
    """Command to verify users and store their info in Google Sheets."""
    member = ctx.author
    discord_id = str(member.id)
    username = str(member.name)

    # Add to Google Sheets
    add_verified_user(discord_id, username, email)

    # Assign Verified Role (Replace with actual role name)
    role_name = "Member"  # Change this to your verified role name
    role = discord.utils.get(ctx.guild.roles, name=role_name)

    if role:
        await member.add_roles(role)
        await ctx.send(f"✅ {member.mention}, you have been verified and added to the server!")
    else:
        await ctx.send("⚠️ Verification failed: Role not found.")

# Run the bot
bot.run(BOT_TOKEN)
